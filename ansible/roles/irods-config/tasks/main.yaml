---

# ignore_errors in case user is like don and picks 'rodsadmin' as an admin name
- name: create DE/services irods user
  sudo: yes
  sudo_user: irods
  shell: "iadmin mkuser {{ irods_user }}#{{ irods_zone }} rodsadmin"
  ignore_errors: true

- name: if DE/services user already exists, ensure it's an admin
  sudo: yes
  sudo_user: irods
  shell: "iadmin moduser {{ irods_user }}#{{ irods_zone }} type rodsadmin"

- name: set DE/services user password
  sudo: yes
  sudo_user: irods
  shell: "iadmin moduser {{ irods_user }}#{{ irods_zone }} password {{ irods_password }}"

- name: /zone/home must be globally readable
  sudo: yes
  sudo_user: irods
  shell: "ichmod read public /{{ irods_zone }}/home"

- name: ensure /zone/home/shared exists
  sudo: yes
  sudo_user: irods
  shell: "imkdir /{{ irods_zone }}/home/shared"
  ignore_errors: true

- name: make /zone/home/shared public writable
  sudo: yes
  sudo_user: irods
  shell: "ichmod -r write public /{{ irods_zone }}/home/shared"

- name: with inheritance
  sudo: yes
  sudo_user: irods
  shell: "ichmod inherit /{{ irods_zone }}/home/shared"

- name: DE wants /OdumDEZone/trash/home/rodsadmin to exist
  sudo: yes
  sudo_user: irods
  shell: "imkdir -p /{{ irods_zone }}/trash/home/{{ irods_user }}"
  ignore_errors: true

- name: DE wants world-writable trash
  sudo: yes
  sudo_user: irods
  shell: "ichmod -r own public /{{ irods_zone }}/trash"

- name: with inheritance
  sudo: yes
  sudo_user: irods
  shell: "ichmod inherit /{{ irods_zone }}/trash"
